<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูููุตุฉ ุงูุฃูุงุฏูููุฉ - ูุฌูุฉ ุงูุทุจ ูุงูุฌุฑุงุญุฉ ุงูุจูุทุฑูุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>

    <script>
        // REPLACE WITH YOUR FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        purple: {
                            50: '#faf5ff', 100: '#f3e8ff', 200: '#e9d5ff', 300: '#d8b4fe',
                            400: '#c084fc', 500: '#a855f7', 600: '#9333ea', 700: '#7c3aed',
                            800: '#6b21a8', 900: '#581c87',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }
        .popup-overlay { backdrop-filter: blur(5px); }
        .card-hover:hover { transform: translateY(-5px); transition: all 0.3s ease; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .sidebar-item { transition: all 0.3s ease; }
        .sidebar-item:hover { background: linear-gradient(90deg, #f3e8ff, #e9d5ff); border-right: 4px solid #9333ea; }
        .sidebar-item.active { background: linear-gradient(90deg, #e9d5ff, #d8b4fe); border-right: 4px solid #7c3aed; color: #581c87; font-weight: 600; }
        .file-upload-area { border: 2px dashed #d8b4fe; transition: all 0.3s ease; }
        .file-upload-area:hover { border-color: #9333ea; background-color: #faf5ff; }
        .file-upload-area.dragover { border-color: #7c3aed; background-color: #f3e8ff; }
        .material-card { background: linear-gradient(145deg, #ffffff, #f8fafc); border: 1px solid #e2e8f0; transition: all 0.3s ease; }
        .material-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(139, 92, 246, 0.15); border-color: #c084fc; }
        .welcome-popup { animation: popupSlide 0.5s ease-out; }
        @keyframes popupSlide { from { opacity: 0; transform: scale(0.8) translateY(-50px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .search-bar { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .notification-badge { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <div id="homePage" class="min-h-screen">
        <header class="bg-white shadow-sm border-b border-purple-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center shadow-lg">
                            <span class="text-white font-bold text-lg">๐ฅ</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900">ุงูููุตุฉ ุงูุฃูุงุฏูููุฉ</h1>
                            <p class="text-sm text-purple-600">ูุฌูุฉ ุงูุทุจ ูุงูุฌุฑุงุญุฉ ุงูุจูุทุฑูุฉ</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <button id="loginBtn" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium shadow-md">
                            ๐ ุชุณุฌูู ุงูุฏุฎูู
                        </button>
                        <button id="registerBtn" class="px-6 py-2 border border-purple-600 text-purple-600 rounded-lg hover:bg-purple-50 transition-colors font-medium">
                            ๐ ุฅูุดุงุก ุญุณุงุจ
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <section class="gradient-bg text-white py-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <div class="fade-in">
                    <h1 class="text-5xl font-bold mb-6">ูุฑุญุจุงู ุจู ูู ุงูููุตุฉ ุงูุฃูุงุฏูููุฉ</h1>
                    <p class="text-xl mb-8 opacity-90">ููุตุฉ ุดุงููุฉ ูุทูุจุฉ ูููุฉ ุงูุทุจ ุงูุจูุทุฑู - ุฌููุน ุงููุตุงุฏุฑ ุงูุฃูุงุฏูููุฉ ูู ููุงู ูุงุญุฏ</p>
                    <div class="flex justify-center space-x-4 space-x-reverse">
                        <button id="heroLoginBtn" class="px-8 py-3 bg-white text-purple-700 rounded-lg hover:bg-gray-100 transition-colors font-semibold shadow-lg">
                            ๐ ุงุจุฏุฃ ุงูุขู
                        </button>
                        <button class="px-8 py-3 border-2 border-white text-white rounded-lg hover:bg-white hover:text-purple-700 transition-colors font-semibold">
                            ๐ ุชุนุฑู ุฃูุซุฑ
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="py-16 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">ูุง ุชูุฏูู ุงูููุตุฉ</h2>
                    <p class="text-lg text-gray-600">ูู ูุง ุชุญุชุงุฌู ูู ุฑุญูุชู ุงูุฃูุงุฏูููุฉ</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="card-hover bg-white rounded-xl shadow-lg p-8 text-center border border-gray-100">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-3xl">๐</span>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-3">ุงูุณูุงูุฏุงุช</h3>
                        <p class="text-gray-600">ุฌููุน ุงููุญุงุถุฑุงุช ูุงูุนุฑูุถ ุงูุชูุฏูููุฉ ููุธูุฉ ุญุณุจ ุงูุณูุฉ ูุงููุตู</p>
                    </div>
                    
                    <div class="card-hover bg-white rounded-xl shadow-lg p-8 text-center border border-gray-100">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-3xl">๐๏ธ</span>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-3">ุงูุชุณุฌููุงุช</h3>
                        <p class="text-gray-600">ุชุณุฌููุงุช ุตูุชูุฉ ููุฑุฆูุฉ ูููุญุงุถุฑุงุช ูุงูุดุฑูุญุงุช ุงููููุฉ</p>
                    </div>
                    
                    <div class="card-hover bg-white rounded-xl shadow-lg p-8 text-center border border-gray-100">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-3xl">๐</span>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-3">ุงูููุฎุตุงุช</h3>
                        <p class="text-gray-600">ููุฎุตุงุช ุดุงููุฉ ููุฑุงุฌุนุงุช ุณุฑูุนุฉ ูุฌููุน ุงูููุงุฏ</p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="bg-gray-900 text-white py-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <p class="text-lg">ููุตุฉ ุฃูุงุฏูููุฉ ููุฏูุฉ ูู ูุฌูุฉ ุงูุทุจ ูุงูุฌุฑุงุญุฉ ุงูุจูุทุฑูุฉ โ ูููุฉ ุงูุทุจ ุงูุจูุทุฑู</p>
                <p class="text-gray-400 mt-2">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ</p>
            </div>
        </footer>
    </div>

    <div id="mainPlatform" class="hidden min-h-screen">
        <header class="bg-white shadow-sm border-b border-purple-100 sticky top-0 z-40">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center shadow-md cursor-pointer" onclick="showLogoSettings()">
                            <span id="defaultLogo" class="text-white font-bold">๐ฅ</span>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold text-gray-900">ุงูููุตุฉ ุงูุฃูุงุฏูููุฉ</h1>
                            <p class="text-xs text-purple-600">ูุฌูุฉ ุงูุทุจ ูุงูุฌุฑุงุญุฉ ุงูุจูุทุฑูุฉ</p>
                        </div>
                    </div>
                    
                    <div class="hidden md:flex items-center space-x-6 space-x-reverse">
                        <button class="main-tab px-4 py-2 text-purple-600 border-b-2 border-purple-600 font-medium active" data-tab="academic" onclick="switchMainTab('academic')">
                            ๐ ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ
                        </button>
                        <button class="main-tab px-4 py-2 text-gray-600 hover:text-purple-600 font-medium" data-tab="posts" onclick="switchMainTab('posts')">
                            ๐ ุงูููุดูุฑุงุช
                        </button>
                        <button class="main-tab px-4 py-2 text-gray-600 hover:text-purple-600 font-medium" data-tab="exams" onclick="switchMainTab('exams')">
                            ๐ ุฌุฏูู ุงูุงูุชุญุงูุงุช
                        </button>
                        <button class="main-tab px-4 py-2 text-gray-600 hover:text-purple-600 font-medium" data-tab="chat" onclick="switchMainTab('chat')">
                            ๐ฌ ุงูุฏุฑุฏุดุฉ
                        </button>
                        <button id="adminTab" class="main-tab px-4 py-2 text-gray-600 hover:text-purple-600 font-medium hidden" data-tab="admin" onclick="switchMainTab('admin')">
                            ๐จโ๐ผ ุงูุฅุฏุงุฑุฉ
                        </button>
                    </div>
                    
                    <div class="hidden md:flex flex-1 max-w-md mx-8">
                        <div class="relative w-full">
                            <input type="text" id="searchInput" placeholder="ุงูุจุญุซ ุนู ูุงุฏุฉ ุฃู ููู..." 
                                   class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent search-bar">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <span class="text-gray-400">๐</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <button id="notificationBtn" class="relative p-2 text-gray-600 hover:text-purple-600 transition-colors" onclick="showNotifications()">
                            <span class="text-xl">๐</span>
                            <span id="notificationCount" class="notification-badge absolute -top-1 -left-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                        </button>
                        
                        <div class="relative">
                            <button id="userMenuBtn" class="flex items-center space-x-2 space-x-reverse text-gray-700 hover:text-purple-600 transition-colors">
                                <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm overflow-hidden">
                                    <img id="userProfilePic" src="" alt="" class="w-full h-full object-cover hidden">
                                    <span id="userAvatar">ุท</span>
                                </div>
                                <span class="hidden md:block font-medium" id="userName">ุทุงูุจ ุงูุทุจ ุงูุจูุทุฑู</span>
                                <span class="text-sm">โ</span>
                            </button>
                            
                            <div id="userDropdown" class="hidden absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <div class="py-2">
                                    <div class="px-4 py-2 border-b border-gray-100">
                                        <div class="text-sm font-medium text-gray-900" id="userFullName">ุทุงูุจ ุงูุทุจ ุงูุจูุทุฑู</div>
                                        <div class="text-xs text-gray-500" id="userYear">ุงูุณูุฉ ุงูุฃููู</div>
                                    </div>
                                    <button onclick="showUserSettings()" class="w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-2 space-x-reverse">
                                        <span>โ๏ธ</span>
                                        <span>ุงูุฅุนุฏุงุฏุงุช</span>
                                    </button>
                                    <button onclick="showProfilePictureModal()" class="w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-2 space-x-reverse">
                                        <span>๐ท</span>
                                        <span>ุชุบููุฑ ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ</span>
                                    </button>
                                    <button id="logoSettingsBtn" class="w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-2 space-x-reverse hidden" onclick="showLogoSettings()">
                                        <span>๐ผ๏ธ</span>
                                        <span>ุชุนุฏูู ุงูุดุนุงุฑ</span>
                                    </button>
                                    <hr class="my-1">
                                    <button id="logoutBtn" class="w-full text-right px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2 space-x-reverse">
                                        <span>๐ช</span>
                                        <span>ุชุณุฌูู ุงูุฎุฑูุฌ</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div id="academicSection" class="flex">
            <aside class="w-80 bg-white shadow-lg border-l border-gray-200 min-h-screen overflow-y-auto">
                <div class="p-4">
                    <div class="mb-6 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-semibold text-purple-800 flex items-center">
                                <span class="mr-2">๐ข</span>
                                ุงูุฅุนูุงูุงุช ุงูุฃูุงุฏูููุฉ
                            </h3>
                            <button id="editAnnouncementsBtn" class="hidden text-purple-600 hover:text-purple-800 text-sm" onclick="editAnnouncements()">
                                โ๏ธ ุชุนุฏูู
                            </button>
                        </div>
                        <div class="space-y-2" id="sidebarAnnouncements">
                            </div>
                    </div>

                    <nav class="space-y-2">
                        <div class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3">ุงูุณููุงุช ุงูุฃูุงุฏูููุฉ</div>
                        
                        <div class="year-section">
                            <button class="sidebar-item w-full text-right px-4 py-3 rounded-lg flex items-center justify-between hover:bg-purple-50" 
                                    onclick="toggleYear(1)">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <span class="text-lg">๐</span>
                                    <span class="font-medium">ุงูุณูุฉ ุงูุฃููู</span>
                                </div>
                                <span class="year-arrow transition-transform" id="arrow-1">โ</span>
                            </button>
                            <div class="year-content hidden mr-8 mt-2 space-y-1" id="year-1">
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(1, 1)">
                                    ๐ ุงููุตู ุงูุฃูู
                                </button>
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(1, 2)">
                                    ๐ ุงููุตู ุงูุซุงูู
                                </button>
                            </div>
                        </div>

                        <div class="year-section">
                            <button class="sidebar-item w-full text-right px-4 py-3 rounded-lg flex items-center justify-between hover:bg-purple-50" 
                                    onclick="toggleYear(2)">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <span class="text-lg">๐</span>
                                    <span class="font-medium">ุงูุณูุฉ ุงูุซุงููุฉ</span>
                                </div>
                                <span class="year-arrow transition-transform" id="arrow-2">โ</span>
                            </button>
                            <div class="year-content hidden mr-8 mt-2 space-y-1" id="year-2">
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(2, 1)">
                                    ๐ ุงููุตู ุงูุฃูู
                                </button>
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(2, 2)">
                                    ๐ ุงููุตู ุงูุซุงูู
                                </button>
                            </div>
                        </div>

                        <div class="year-section">
                            <button class="sidebar-item w-full text-right px-4 py-3 rounded-lg flex items-center justify-between hover:bg-purple-50" 
                                    onclick="toggleYear(3)">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <span class="text-lg">๐</span>
                                    <span class="font-medium">ุงูุณูุฉ ุงูุซุงูุซุฉ</span>
                                </div>
                                <span class="year-arrow transition-transform" id="arrow-3">โ</span>
                            </button>
                            <div class="year-content hidden mr-8 mt-2 space-y-1" id="year-3">
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(3, 1)">
                                    ๐ ุงููุตู ุงูุฃูู
                                </button>
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(3, 2)">
                                    ๐ ุงููุตู ุงูุซุงูู
                                </button>
                            </div>
                        </div>

                        <div class="year-section">
                            <button class="sidebar-item w-full text-right px-4 py-3 rounded-lg flex items-center justify-between hover:bg-purple-50" 
                                    onclick="toggleYear(4)">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <span class="text-lg">๐</span>
                                    <span class="font-medium">ุงูุณูุฉ ุงูุฑุงุจุนุฉ</span>
                                </div>
                                <span class="year-arrow transition-transform" id="arrow-4">โ</span>
                            </button>
                            <div class="year-content hidden mr-8 mt-2 space-y-1" id="year-4">
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(4, 1)">
                                    ๐ ุงููุตู ุงูุฃูู
                                </button>
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(4, 2)">
                                    ๐ ุงููุตู ุงูุซุงูู
                                </button>
                            </div>
                        </div>

                        <div class="year-section">
                            <button class="sidebar-item w-full text-right px-4 py-3 rounded-lg flex items-center justify-between hover:bg-purple-50" 
                                    onclick="toggleYear(5)">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <span class="text-lg">๐</span>
                                    <span class="font-medium">ุงูุณูุฉ ุงูุฎุงูุณุฉ</span>
                                </div>
                                <span class="year-arrow transition-transform" id="arrow-5">โ</span>
                            </button>
                            <div class="year-content hidden mr-8 mt-2 space-y-1" id="year-5">
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(5, 1)">
                                    ๐ ุงููุตู ุงูุฃูู
                                </button>
                                <button class="semester-btn w-full text-right px-4 py-2 rounded text-sm hover:bg-purple-50" 
                                        onclick="showSemester(5, 2)">
                                    ๐ ุงููุตู ุงูุซุงูู
                                </button>
                            </div>
                        </div>
                    </nav>
                </div>
            </aside>

            <main class="flex-1 p-6 bg-gray-50">
                <div id="welcomeSection" class="text-center py-16">
                    <div class="max-w-2xl mx-auto">
                        <div class="w-24 h-24 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                            <span class="text-white text-4xl">๐</span>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-900 mb-4">ูุฑุญุจุงู ุจู ูู ุงูููุตุฉ ุงูุฃูุงุฏูููุฉ</h2>
                        <p class="text-lg text-gray-600 mb-8">ุงุฎุชุฑ ุงูุณูุฉ ูุงููุตู ุงูุฏุฑุงุณู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ููุจุฏุก</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-white rounded-lg p-6 shadow-md border border-gray-100">
                                <div class="text-3xl mb-3">๐</div>
                                <h3 class="font-semibold text-gray-900 mb-2">ุงูุณูุงูุฏุงุช</h3>
                                <p class="text-sm text-gray-600">ุนุฑูุถ ุชูุฏูููุฉ ุดุงููุฉ</p>
                            </div>
                            <div class="bg-white rounded-lg p-6 shadow-md border border-gray-100">
                                <div class="text-3xl mb-3">๐๏ธ</div>
                                <h3 class="font-semibold text-gray-900 mb-2">ุงูุชุณุฌููุงุช</h3>
                                <p class="text-sm text-gray-600">ูุญุงุถุฑุงุช ุตูุชูุฉ ููุฑุฆูุฉ</p>
                            </div>
                            <div class="bg-white rounded-lg p-6 shadow-md border border-gray-100">
                                <div class="text-3xl mb-3">๐</div>
                                <h3 class="font-semibold text-gray-900 mb-2">ุงูููุฎุตุงุช</h3>
                                <p class="text-sm text-gray-600">ูุฑุงุฌุนุงุช ุณุฑูุนุฉ ููููุฏุฉ</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="semesterContent" class="hidden">
                    <nav class="flex mb-6" aria-label="Breadcrumb">
                        <ol class="inline-flex items-center space-x-1 md:space-x-3 space-x-reverse">
                            <li class="inline-flex items-center">
                                <span class="text-gray-500">๐</span>
                                <span class="mr-2 text-sm font-medium text-gray-500">ุงูุฑุฆูุณูุฉ</span>
                            </li>
                            <li>
                                <div class="flex items-center">
                                    <span class="text-gray-400">โ</span>
                                    <span class="mr-2 text-sm font-medium text-gray-700" id="currentYear">ุงูุณูุฉ ุงูุฃููู</span>
                                </div>
                            </li>
                            <li>
                                <div class="flex items-center">
                                    <span class="text-gray-400">โ</span>
                                    <span class="mr-2 text-sm font-medium text-purple-600" id="currentSemester">ุงููุตู ุงูุฃูู</span>
                                </div>
                            </li>
                        </ol>
                    </nav>

                    <div class="mb-6">
                        <button id="addSubjectBtn" class="hidden px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium shadow-md flex items-center space-x-2 space-x-reverse">
                            <span>โ</span>
                            <span>ุฅุถุงูุฉ ูุงุฏุฉ ุฌุฏูุฏุฉ</span>
                        </button>
                    </div>

                    <div id="subjectsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        </div>
                </div>

                <div id="subjectMaterials" class="hidden">
                    <button id="backToSubjects" class="mb-4 px-4 py-2 text-purple-600 hover:text-purple-800 flex items-center space-x-2 space-x-reverse">
                        <span>โฉ๏ธ</span>
                        <span>ุงูุนูุฏุฉ ููููุงุฏ</span>
                    </button>

                    <div class="bg-white rounded-lg shadow-md p-6 mb-6 border border-gray-100">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2" id="subjectTitle">ุงุณู ุงููุงุฏุฉ</h2>
                        <p class="text-gray-600" id="subjectInfo">ุงูุณูุฉ ุงูุฃููู - ุงููุตู ุงูุฃูู</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-md mb-6 border border-gray-100">
                        <div class="border-b border-gray-200">
                            <nav class="flex space-x-8 space-x-reverse px-6">
                                <button class="material-tab py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium flex items-center space-x-2 space-x-reverse active" 
                                        data-type="slides" onclick="switchMaterialTab('slides')">
                                    <span>๐</span>
                                    <span>ุงูุณูุงูุฏุงุช</span>
                                </button>
                                <button class="material-tab py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium flex items-center space-x-2 space-x-reverse" 
                                        data-type="recordings" onclick="switchMaterialTab('recordings')">
                                    <span>๐๏ธ</span>
                                    <span>ุงูุชุณุฌููุงุช</span>
                                </button>
                                <button class="material-tab py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium flex items-center space-x-2 space-x-reverse" 
                                        data-type="summaries" onclick="switchMaterialTab('summaries')">
                                    <span>๐</span>
                                    <span>ุงูููุฎุตุงุช</span>
                                </button>
                            </nav>
                        </div>

                        <div class="px-6 py-4 bg-gray-50">
                            <div class="flex space-x-4 space-x-reverse">
                                <button class="exam-tab px-4 py-2 bg-purple-600 text-white rounded-lg font-medium active" 
                                        data-exam="mid" onclick="switchExamTab('mid')">
                                    ๐ ุงูููุฏ
                                </button>
                                <button class="exam-tab px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium" 
                                        data-exam="final" onclick="switchExamTab('final')">
                                    ๐ ุงููุงููุงู
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="uploadSection" class="hidden bg-white rounded-lg shadow-md p-6 mb-6 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">ุฑูุน ููู ุฌุฏูุฏ</h3>
                        <div class="file-upload-area rounded-lg p-8 text-center cursor-pointer" id="uploadArea">
                            <input type="file" id="fileInput" class="hidden" multiple accept=".pdf,.mp3,.mp4,.doc,.docx,.ppt,.pptx">
                            <div class="text-4xl mb-4">๐</div>
                            <p class="text-lg font-medium text-gray-700 mb-2">ุงุณุญุจ ุงููููุงุช ููุง ุฃู ุงุถุบุท ููุงุฎุชูุงุฑ</p>
                            <p class="text-sm text-gray-500">ูุฏุนู: PDF, MP3, MP4, DOC, PPT ุฃู ุฑุงุจุท URL</p>
                        </div>
                        
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุฃู ุฃุฏุฎู ุฑุงุจุท URL</label>
                            <div class="flex space-x-2 space-x-reverse">
                                <input type="url" id="urlInput" placeholder="https://example.com/file" 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <button id="addUrlBtn" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                    ุฅุถุงูุฉ
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md border border-gray-100">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900" id="materialsTitle">ุงูุณูุงูุฏุงุช - ุงูููุฏ</h3>
                        </div>
                        <div class="p-6">
                            <div id="materialsList" class="space-y-4">
                                </div>
                            <div id="emptyState" class="text-center py-8 text-gray-500">
                                <div class="text-4xl mb-4">๐</div>
                                <p>ูุง ุชูุฌุฏ ูููุงุช ุจุนุฏ. ุงุจุฏุฃ ุจุฑูุน ุฃูู ููู!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="postsSection" class="hidden p-6 bg-gray-50 min-h-screen">
                    <div class="max-w-4xl mx-auto">
                        <div class="mb-6">
                            <button id="createPostBtn" class="w-full bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors font-medium shadow-md flex items-center justify-center space-x-2 space-x-reverse" onclick="showCreatePost()">
                                <span>โ๏ธ</span>
                                <span>ุฅูุดุงุก ููุดูุฑ ุฌุฏูุฏ</span>
                            </button>
                        </div>

                        <div id="createPostSection" class="hidden bg-white rounded-lg shadow-md p-6 mb-6 border border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">ุฅูุดุงุก ููุดูุฑ ุฌุฏูุฏ</h3>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ููุน ุงูููุดูุฑ</label>
                                <div class="flex space-x-4 space-x-reverse">
                                    <button class="post-type-btn px-4 py-2 bg-purple-600 text-white rounded-lg font-medium active" data-type="normal" onclick="selectPostType('normal')">
                                        ๐ ููุดูุฑ ุนุงุฏู
                                    </button>
                                    <button class="post-type-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium" data-type="poll" onclick="selectPostType('poll')">
                                        ๐ ุงุณุชุทูุงุน ุฑุฃู
                                    </button>
                                    <button class="post-type-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium" data-type="announcement" onclick="selectPostType('announcement')">
                                        ๐ข ุฅุนูุงู ุฑุณูู
                                    </button>
                                </div>
                            </div>
                            <form id="createPostForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ูุญุชูู ุงูููุดูุฑ</label>
                                    <textarea id="postContent" rows="4" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 resize-none" placeholder="ุงูุชุจ ูุญุชูู ุงูููุดูุฑ ููุง..."></textarea>
                                </div>

                                <div id="pollOptions" class="hidden">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ุฎูุงุฑุงุช ุงูุงุณุชุทูุงุน</label>
                                    <div id="pollChoices" class="space-y-2">
                                        <input type="text" class="poll-choice w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="ุงูุฎูุงุฑ ุงูุฃูู">
                                        <input type="text" class="poll-choice w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="ุงูุฎูุงุฑ ุงูุซุงูู">
                                    </div>
                                    <button type="button" onclick="addPollChoice()" class="mt-2 px-3 py-1 text-sm bg-purple-100 text-purple-700 rounded hover:bg-purple-200">
                                        โ ุฅุถุงูุฉ ุฎูุงุฑ
                                    </button>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ุงุณุชูุฏุงู ุงูุณูุฉ</label>
                                    <select id="targetYear" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                        <option value="all">ุฌููุน ุงูุณููุงุช</option>
                                        <option value="1">ุงูุณูุฉ ุงูุฃููู</option>
                                        <option value="2">ุงูุณูุฉ ุงูุซุงููุฉ</option>
                                        <option value="3">ุงูุณูุฉ ุงูุซุงูุซุฉ</option>
                                        <option value="4">ุงูุณูุฉ ุงูุฑุงุจุนุฉ</option>
                                        <option value="5">ุงูุณูุฉ ุงูุฎุงูุณุฉ</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุฃููููุฉ</label>
                                    <select id="postPriority" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                        <option value="normal">ุนุงุฏู</option>
                                        <option value="important">ููู</option>
                                        <option value="urgent">ุนุงุฌู</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุตูุฑ (ุงุฎุชูุงุฑู)</label>
                                    <input type="file" id="postImages" multiple accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>

                                <div class="flex space-x-3 space-x-reverse">
                                    <button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-medium">
                                        ๐ ูุดุฑ ุงูููุดูุฑ
                                    </button>
                                    <button type="button" onclick="cancelCreatePost()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-medium">
                                        ุฅูุบุงุก
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div id="postsFeed" class="space-y-6">
                            </div>

                        <div id="postsEmptyState" class="text-center py-16 hidden">
                            <div class="text-6xl mb-4">๐</div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">ูุง ุชูุฌุฏ ููุดูุฑุงุช ุจุนุฏ</h3>
                            <p class="text-gray-600">ุงุจุฏุฃ ุจุฅูุดุงุก ุฃูู ููุดูุฑ!</p>
                        </div>
                    </div>
                </div>

                <div id="examsSection" class="hidden p-6 bg-gray-50 min-h-screen">
                    <div class="max-w-6xl mx-auto">
                        <div class="bg-white rounded-lg shadow-md p-6 border border-gray-100">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">๐ ุฌุฏูู ุงูุงูุชุญุงูุงุช</h2>
                                <button id="addExamBtn" class="hidden px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium" onclick="showAddExamModal()">
                                    โ ุฅุถุงูุฉ ุงูุชุญุงู
                                </button>
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงุฎุชุฑ ุงูุณูุฉ ุงูุฏุฑุงุณูุฉ</label>
                                <select id="examYearFilter" onchange="filterExams()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                    <option value="all">ุฌููุน ุงูุณููุงุช</option>
                                    <option value="1">ุงูุณูุฉ ุงูุฃููู</option>
                                    <option value="2">ุงูุณูุฉ ุงูุซุงููุฉ</option>
                                    <option value="3">ุงูุณูุฉ ุงูุซุงูุซุฉ</option>
                                    <option value="4">ุงูุณูุฉ ุงูุฑุงุจุนุฉ</option>
                                    <option value="5">ุงูุณูุฉ ุงูุฎุงูุณุฉ</option>
                                </select>
                            </div>
                            <div id="examsCalendar" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                </div>
                            <div id="examsEmptyState" class="text-center py-16 hidden">
                                <div class="text-6xl mb-4">๐</div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">ูุง ุชูุฌุฏ ุงูุชุญุงูุงุช ูุฌุฏููุฉ</h3>
                                <p class="text-gray-600">ุงุจุฏุฃ ุจุฅุถุงูุฉ ุฃูู ุงูุชุญุงู!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="chatSection" class="hidden p-6 bg-gray-50 min-h-screen">
                    <div class="max-w-4xl mx-auto">
                        <div class="bg-white rounded-lg shadow-md border border-gray-100 h-96 flex flex-col">
                            <div class="p-4 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-purple-100">
                                <h3 class="font-semibold text-purple-900 flex items-center">
                                    <span class="mr-2">๐ฌ</span> ุงูุฏุฑุฏุดุฉ ูุน ุงูุฅุฏุงุฑุฉ
                                </h3>
                                <p class="text-sm text-purple-600">ุชูุงุตู ูุจุงุดุฑ ูุน ูุฑูู ุงูุฅุฏุงุฑุฉ</p>
                            </div>
                            <div id="chatMessages" class="flex-1 p-4 overflow-y-auto space-y-4">
                                <div class="flex items-start space-x-3 space-x-reverse">
                                    <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-white text-sm font-semibold"> ุฅ </div>
                                    <div class="bg-purple-100 rounded-lg p-3 max-w-xs">
                                        <div class="text-sm font-medium text-purple-900">ุงูุฅุฏุงุฑุฉ</div>
                                        <div class="text-sm text-purple-700">ูุฑุญุจุงู! ููู ูููููุง ูุณุงุนุฏุชูุ</div>
                                        <div class="text-xs text-purple-500 mt-1">10:30 ุต</div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 border-t border-gray-200">
                                <div class="flex space-x-2 space-x-reverse">
                                    <input type="text" id="chatInput" placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onkeypress="if(event.key==='Enter') sendMessage()">
                                    <button onclick="sendMessage()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                        ๐ค ุฅุฑุณุงู
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="adminSection" class="hidden p-6 bg-gray-50 min-h-screen">
                    </div>
            </div>

            <div id="loginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 popup-overlay z-50">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 welcome-popup">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <span class="text-white text-2xl">๐</span>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-2">ุชุณุฌูู ุงูุฏุฎูู</h2>
                            <p class="text-gray-600">ุฃุฏุฎู ุจูุงูุงุชู ูููุตูู ุฅูู ุงูููุตุฉ</p>
                        </div>
                        <form id="loginForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงุณู ุงููุณุชุฎุฏู</label>
                                <input type="text" id="loginUsername" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ูููุฉ ุงููุฑูุฑ</label>
                                <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="ูููุฉ ุงููุฑูุฑ">
                            </div>
                            <button type="submit" class="w-full px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold shadow-md">
                                ุชุณุฌูู ุงูุฏุฎูู
                            </button>
                        </form>
                        <p id="loginError" class="text-center text-red-500 mt-4 hidden">ุฎุทุฃ ูู ุชุณุฌูู ุงูุฏุฎูู. ูุฑุฌู ุงูุชุญูู ูู ุงูุจูุงูุงุช.</p>
                    </div>
                </div>
            </div>

            <div id="registerModal" class="hidden fixed inset-0 bg-black bg-opacity-50 popup-overlay z-50">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 welcome-popup">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <span class="text-white text-2xl">๐</span>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-2">ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</h2>
                            <p class="text-gray-600">ุงูุถู ุฅูู ุงูููุตุฉ ูู ุฎุทูุงุช ุจุณูุทุฉ</p>
                        </div>
                        <form id="registerForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงุณู ุงููุณุชุฎุฏู</label>
                                <input type="text" id="registerUsername" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ูููุฉ ุงููุฑูุฑ</label>
                                <input type="password" id="registerPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="ูููุฉ ุงููุฑูุฑ (6 ุฃุญุฑู ุนูู ุงูุฃูู)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุณูุฉ ุงูุฏุฑุงุณูุฉ</label>
                                <select id="registerYear" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                    <option value="1">ุงูุณูุฉ ุงูุฃููู</option>
                                    <option value="2">ุงูุณูุฉ ุงูุซุงููุฉ</option>
                                    <option value="3">ุงูุณูุฉ ุงูุซุงูุซุฉ</option>
                                    <option value="4">ุงูุณูุฉ ุงูุฑุงุจุนุฉ</option>
                                    <option value="5">ุงูุณูุฉ ุงูุฎุงูุณุฉ</option>
                                    <option value="admin">ุฅุฏุงุฑุฉ (ููุงุณุชุฎุฏุงู ุงูุฏุงุฎูู)</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold shadow-md">
                                ุฅูุดุงุก ุงูุญุณุงุจ
                            </button>
                        </form>
                        <p id="registerError" class="text-center text-red-500 mt-4 hidden">ูุดู ูู ุฅูุดุงุก ุงูุญุณุงุจ. ูุฏ ูููู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุณุชุฎุฏูุงู ุจุงููุนู.</p>
                    </div>
                </div>
            </div>

            <div id="profilePictureModal" class="hidden fixed inset-0 bg-black bg-opacity-50 popup-overlay z-50">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 welcome-popup">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <span class="text-white text-2xl">๐ท</span>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-2">ุชุบููุฑ ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ</h2>
                            <p class="text-gray-600">ุงุฎุชุฑ ุตูุฑุฉ ุฌุฏูุฏุฉ ูุญุณุงุจู</p>
                        </div>
                        <form id="profilePictureForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุฑูุน ุตูุฑุฉ ุฌุฏูุฏุฉ</label>
                                <input type="file" id="profilePictureInput" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                            <div class="flex space-x-3 space-x-reverse">
                                <button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-medium">
                                    ุญูุธ ุงูุตูุฑุฉ
                                </button>
                                <button type="button" onclick="closeProfilePictureModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-medium">
                                    ุฅูุบุงุก
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div id="logoSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 popup-overlay z-50">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 welcome-popup">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <span class="text-white text-2xl">๐ผ๏ธ</span>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-2">ุชุนุฏูู ุดุนุงุฑ ุงูููุตุฉ</h2>
                            <p class="text-gray-600">ูู ุจุชุญููู ุดุนุงุฑ ุฌุฏูุฏ ููููุตุฉ</p>
                        </div>
                        <form id="logoForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุฑูุน ุดุนุงุฑ ุฌุฏูุฏ</label>
                                <input type="file" id="logoInput" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            </div>
                            <div class="flex space-x-3 space-x-reverse">
                                <button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-medium">
                                    ุญูุธ ุงูุดุนุงุฑ
                                </button>
                                <button type="button" onclick="closeLogoSettingsModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-medium">
                                    ุฅูุบุงุก
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div id="addSubjectModal" class="hidden fixed inset-0 bg-black bg-opacity-50 popup-overlay z-50">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 welcome-popup">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <span class="text-white text-2xl">โ</span>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-2">ุฅุถุงูุฉ ูุงุฏุฉ ุฌุฏูุฏุฉ</h2>
                            <p class="text-gray-600">ุฃุฏุฎู ุชูุงุตูู ุงููุงุฏุฉ ุงูุฏุฑุงุณูุฉ ุงูุฌุฏูุฏุฉ</p>
                        </div>
                        <form id="addSubjectForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงุณู ุงููุงุฏุฉ</label>
                                <input type="text" id="newSubjectName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุณูุฉ ุงูุฏุฑุงุณูุฉ</label>
                                <select id="newSubjectYear" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                    <option value="1">ุงูุณูุฉ ุงูุฃููู</option>
                                    <option value="2">ุงูุณูุฉ ุงูุซุงููุฉ</option>
                                    <option value="3">ุงูุณูุฉ ุงูุซุงูุซุฉ</option>
                                    <option value="4">ุงูุณูุฉ ุงูุฑุงุจุนุฉ</option>
                                    <option value="5">ุงูุณูุฉ ุงูุฎุงูุณุฉ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงููุตู ุงูุฏุฑุงุณู</label>
                                <select id="newSubjectSemester" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                    <option value="1">ุงููุตู ุงูุฃูู</option>
                                    <option value="2">ุงููุตู ุงูุซุงูู</option>
                                </select>
                            </div>
                            <div class="flex space-x-3 space-x-reverse">
                                <button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-medium">
                                    ุฅุถุงูุฉ ุงููุงุฏุฉ
                                </button>
                                <button type="button" onclick="closeAddSubjectModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-medium">
                                    ุฅูุบุงุก
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div id="addExamModal" class="hidden fixed inset-0 bg-black bg-opacity-50 popup-overlay z-50">
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 welcome-popup">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <span class="text-white text-2xl">๐</span>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-2">ุฅุถุงูุฉ ุงูุชุญุงู ุฌุฏูุฏ</h2>
                            <p class="text-gray-600">ุฃุฏุฎู ุชูุงุตูู ุงูุงูุชุญุงู ุงูุฌุฏูุฏ</p>
                        </div>
                        <form id="addExamForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงุณู ุงููุงุฏุฉ</label>
                                <input type="text" id="newExamSubject" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุณูุฉ ุงูุฏุฑุงุณูุฉ</label>
                                <select id="newExamYear" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                    <option value="1">ุงูุณูุฉ ุงูุฃููู</option>
                                    <option value="2">ุงูุณูุฉ ุงูุซุงููุฉ</option>
                                    <option value="3">ุงูุณูุฉ ุงูุซุงูุซุฉ</option>
                                    <option value="4">ุงูุณูุฉ ุงูุฑุงุจุนุฉ</option>
                                    <option value="5">ุงูุณูุฉ ุงูุฎุงูุณุฉ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุชุงุฑูุฎ ุงูุงูุชุญุงู</label>
                                <input type="date" id="newExamDate" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงูููุช</label>
                                <input type="time" id="newExamTime" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div class="flex space-x-3 space-x-reverse">
                                <button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-medium">
                                    ุฅุถุงูุฉ ุงูุงูุชุญุงู
                                </button>
                                <button type="button" onclick="closeAddExamModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-medium">
                                    ุฅูุบุงุก
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <script>
                // Data objects will now be managed by Firebase, so we'll remove local copies
                let currentUser = null; // Store current user info
                let allSubjects = [];
                let allPosts = [];
                let allExams = [];
                let allAnnouncements = [];
                let currentSubjectId = null; // Keep track of the current subject for file uploads

                // Helper functions to open/close modals
                function showLoginModal() { document.getElementById('loginModal').classList.remove('hidden'); }
                function closeLoginModal() { document.getElementById('loginModal').classList.add('hidden'); }
                function showRegisterModal() { document.getElementById('registerModal').classList.remove('hidden'); }
                function closeRegisterModal() { document.getElementById('registerModal').classList.add('hidden'); }
                function showProfilePictureModal() { document.getElementById('profilePictureModal').classList.remove('hidden'); }
                function closeProfilePictureModal() { document.getElementById('profilePictureModal').classList.add('hidden'); }
                function showLogoSettings() { document.getElementById('logoSettingsModal').classList.remove('hidden'); }
                function closeLogoSettingsModal() { document.getElementById('logoSettingsModal').classList.add('hidden'); }
                function showAddSubjectModal() { document.getElementById('addSubjectModal').classList.remove('hidden'); }
                function closeAddSubjectModal() { document.getElementById('addSubjectModal').classList.add('hidden'); }
                function showAddExamModal() { document.getElementById('addExamModal').classList.remove('hidden'); }
                function closeAddExamModal() { document.getElementById('addExamModal').classList.add('hidden'); }

                // UI State
                function switchMainTab(tabName) {
                    ['academicSection', 'postsSection', 'examsSection', 'chatSection', 'adminSection'].forEach(id => {
                        document.getElementById(id).classList.add('hidden');
                    });
                    document.getElementById(tabName + 'Section').classList.remove('hidden');
                    
                    document.querySelectorAll('.main-tab').forEach(tab => {
                        tab.classList.remove('active', 'text-purple-600', 'border-purple-600');
                        tab.classList.add('text-gray-600', 'hover:text-purple-600');
                    });
                    
                    const activeTab = document.querySelector(`.main-tab[data-tab="${tabName}"]`);
                    activeTab.classList.add('active', 'text-purple-600', 'border-purple-600');
                    activeTab.classList.remove('text-gray-600', 'hover:text-purple-600');

                    // Load content based on the tab
                    if (tabName === 'posts') {
                        loadPosts();
                    } else if (tabName === 'exams') {
                        loadExams();
                    } else if (tabName === 'academic') {
                        // Re-render academic content if needed
                    } else if (tabName === 'chat') {
                        loadChatMessages();
                    }
                }

                function showSemester(year, semester) {
                    loadSubjects(year, semester);
                    document.getElementById('welcomeSection').classList.add('hidden');
                    document.getElementById('subjectMaterials').classList.add('hidden');
                    document.getElementById('semesterContent').classList.remove('hidden');
                    document.getElementById('currentYear').textContent = `ุงูุณูุฉ ${year}`;
                    document.getElementById('currentSemester').textContent = `ุงููุตู ${semester}`;
                    document.querySelectorAll('.semester-btn').forEach(btn => btn.classList.remove('sidebar-item', 'active'));
                    document.querySelector(`[onclick="showSemester(${year}, ${semester})"]`).classList.add('sidebar-item', 'active');
                }

                function showSubjectMaterials(subjectId, subjectName, year, semester) {
                    currentSubjectId = subjectId;
                    loadMaterials(subjectId, subjectName, year, semester);
                    document.getElementById('semesterContent').classList.add('hidden');
                    document.getElementById('subjectMaterials').classList.remove('hidden');
                    document.getElementById('subjectTitle').textContent = subjectName;
                    document.getElementById('subjectInfo').textContent = `ุงูุณูุฉ ${year} - ุงููุตู ${semester}`;
                }

                function switchMaterialTab(type) {
                    document.querySelectorAll('.material-tab').forEach(tab => {
                        tab.classList.remove('active', 'border-purple-600', 'text-purple-600');
                        tab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                    });
                    const activeTab = document.querySelector(`.material-tab[data-type="${type}"]`);
                    activeTab.classList.add('active', 'border-purple-600', 'text-purple-600');
                    activeTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                    
                    const examType = document.querySelector('.exam-tab.active').dataset.exam;
                    loadMaterialsByType(type, examType);
                    document.getElementById('materialsTitle').textContent = `${document.getElementById('subjectTitle').textContent} - ${activeTab.textContent.trim()} (${document.querySelector('.exam-tab.active').textContent.trim()})`;
                }

                function switchExamTab(exam) {
                    document.querySelectorAll('.exam-tab').forEach(tab => {
                        tab.classList.remove('active', 'bg-purple-600', 'text-white');
                        tab.classList.add('bg-gray-200', 'text-gray-700');
                    });
                    const activeTab = document.querySelector(`.exam-tab[data-exam="${exam}"]`);
                    activeTab.classList.add('active', 'bg-purple-600', 'text-white');
                    activeTab.classList.remove('bg-gray-200', 'text-gray-700');
                    
                    const materialType = document.querySelector('.material-tab.active').dataset.type;
                    loadMaterialsByType(materialType, exam);
                    document.getElementById('materialsTitle').textContent = `${document.getElementById('subjectTitle').textContent} - ${document.querySelector('.material-tab.active').textContent.trim()} (${activeTab.textContent.trim()})`;
                }
                
                function toggleYear(year) {
                    const content = document.getElementById(`year-${year}`);
                    const arrow = document.getElementById(`arrow-${year}`);
                    content.classList.toggle('hidden');
                    arrow.classList.toggle('rotate-90');
                }

                // --- Firebase Functions ---
                
                // User Registration
                document.getElementById('registerForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const email = document.getElementById('registerUsername').value;
                    const password = document.getElementById('registerPassword').value;
                    const year = document.getElementById('registerYear').value;
                    const isAdmin = year === 'admin';

                    auth.createUserWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            const user = userCredential.user;
                            return db.collection('users').doc(user.uid).set({
                                email: email,
                                year: isAdmin ? 'admin' : year,
                                isAdmin: isAdmin,
                                fullName: `ุทุงูุจ ุงูุณูุฉ ${year}`,
                                avatar: `ุท`
                            }).then(() => {
                                closeRegisterModal();
                                alert('ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ!');
                            });
                        })
                        .catch((error) => {
                            document.getElementById('registerError').classList.remove('hidden');
                            console.error("Registration Error: ", error);
                        });
                });

                // User Login
                document.getElementById('loginForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const email = document.getElementById('loginUsername').value;
                    const password = document.getElementById('loginPassword').value;

                    auth.signInWithEmailAndPassword(email, password)
                        .then(() => {
                            closeLoginModal();
                        })
                        .catch((error) => {
                            document.getElementById('loginError').classList.remove('hidden');
                            console.error("Login Error: ", error);
                        });
                });

                // User Logout
                document.getElementById('logoutBtn').addEventListener('click', function() {
                    auth.signOut().then(() => {
                        window.location.reload(); // Reload the page to go back to the home page
                    }).catch((error) => {
                        console.error("Logout Error: ", error);
                    });
                });

                // Real-time listener for auth state changes
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        currentUser = user;
                        db.collection('users').doc(user.uid).get().then(doc => {
                            if (doc.exists) {
                                const userData = doc.data();
                                if (userData.isAdmin) {
                                    document.getElementById('adminTab').classList.remove('hidden');
                                    document.getElementById('addSubjectBtn').classList.remove('hidden');
                                    document.getElementById('addExamBtn').classList.remove('hidden');
                                    document.getElementById('editAnnouncementsBtn').classList.remove('hidden');
                                    document.getElementById('uploadSection').classList.remove('hidden');
                                }
                                document.getElementById('userName').textContent = userData.fullName;
                                document.getElementById('userFullName').textContent = userData.fullName;
                                document.getElementById('userYear').textContent = `ุงูุณูุฉ ${userData.year}`;
                                document.getElementById('userAvatar').textContent = userData.avatar;
                                document.getElementById('homePage').classList.add('hidden');
                                document.getElementById('mainPlatform').classList.remove('hidden');
                                loadAnnouncements(); // Load announcements on login
                            }
                        });
                    } else {
                        currentUser = null;
                        document.getElementById('homePage').classList.remove('hidden');
                        document.getElementById('mainPlatform').classList.add('hidden');
                    }
                });
                
                // Function to load subjects from Firestore
                function loadSubjects(year, semester) {
                    const subjectsGrid = document.getElementById('subjectsGrid');
                    subjectsGrid.innerHTML = '';
                    db.collection('subjects').where('year', '==', year).where('semester', '==', semester).get()
                        .then(snapshot => {
                            snapshot.forEach(doc => {
                                const subject = doc.data();
                                const subjectCard = document.createElement('div');
                                subjectCard.className = 'bg-white rounded-lg p-6 shadow-md border border-gray-100 material-card cursor-pointer';
                                subjectCard.onclick = () => showSubjectMaterials(doc.id, subject.name, year, semester);
                                subjectCard.innerHTML = `
                                    <div class="text-3xl mb-3">๐</div>
                                    <h3 class="font-semibold text-gray-900 mb-2">${subject.name}</h3>
                                    <p class="text-sm text-gray-600">ูุญุงุถุฑุงุช</p>
                                `;
                                subjectsGrid.appendChild(subjectCard);
                            });
                        })
                        .catch(error => {
                            console.error("Error loading subjects: ", error);
                        });
                }

                // Function to add a new subject
                document.getElementById('addSubjectForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const name = document.getElementById('newSubjectName').value;
                    const year = document.getElementById('newSubjectYear').value;
                    const semester = document.getElementById('newSubjectSemester').value;
                    
                    db.collection('subjects').add({
                        name: name,
                        year: parseInt(year),
                        semester: parseInt(semester),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        closeAddSubjectModal();
                        alert('ุชู ุฅุถุงูุฉ ุงููุงุฏุฉ ุจูุฌุงุญ!');
                        loadSubjects(parseInt(year), parseInt(semester)); // Reload the subjects list
                    }).catch(error => {
                        console.error("Error adding subject: ", error);
                    });
                });
                
                // Function to load materials from Firestore
                function loadMaterials(subjectId, subjectName, year, semester) {
                    db.collection('materials').where('subjectId', '==', subjectId).get()
                        .then(snapshot => {
                            allMaterials = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                            const materialType = document.querySelector('.material-tab.active').dataset.type;
                            const examType = document.querySelector('.exam-tab.active').dataset.exam;
                            renderMaterials(allMaterials.filter(m => m.type === materialType && m.exam === examType));
                        })
                        .catch(error => {
                            console.error("Error loading materials: ", error);
                        });
                }
                
                // Function to render materials based on filter
                function renderMaterials(materials) {
                    const materialsList = document.getElementById('materialsList');
                    materialsList.innerHTML = '';
                    if (materials.length === 0) {
                        document.getElementById('emptyState').classList.remove('hidden');
                    } else {
                        document.getElementById('emptyState').classList.add('hidden');
                        materials.forEach(material => {
                            const materialItem = document.createElement('div');
                            materialItem.className = 'flex items-center space-x-4 space-x-reverse bg-gray-50 p-4 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer';
                            materialItem.innerHTML = `
                                <span class="text-3xl">๐</span>
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-800">${material.title}</h4>
                                    <p class="text-sm text-gray-500">${material.type} - ${material.exam}</p>
                                </div>
                                <a href="${material.url}" target="_blank" class="px-4 py-2 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700">ุชุญููู</a>
                            `;
                            materialsList.appendChild(materialItem);
                        });
                    }
                }
                
                // File and URL upload functions
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');

                uploadArea.addEventListener('click', () => fileInput.click());
                uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
                uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        uploadFiles(files);
                    }
                });
                fileInput.addEventListener('change', (e) => {
                    uploadFiles(e.target.files);
                });

                function uploadFiles(files) {
                    if (!currentSubjectId) {
                        alert('ูุฌุจ ุชุญุฏูุฏ ูุงุฏุฉ ุฃููุงู!');
                        return;
                    }

                    for (const file of files) {
                        const fileTitle = file.name;
                        const storageRef = storage.ref(`materials/${currentSubjectId}/${file.name}`);
                        const uploadTask = storageRef.put(file);

                        uploadTask.on('state_changed', 
                            (snapshot) => {
                                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                                console.log('Upload is ' + progress + '% done');
                            },
                            (error) => {
                                console.error("Upload failed: ", error);
                                alert('ูุดู ูู ุฑูุน ุงูููู: ' + error.message);
                            },
                            () => {
                                uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                                    console.log('File available at', downloadURL);
                                    saveMaterialToFirestore(fileTitle, downloadURL, file.type, 'mid', currentSubjectId);
                                });
                            }
                        );
                    }
                }

                document.getElementById('addUrlBtn').addEventListener('click', () => {
                    const url = document.getElementById('urlInput').value;
                    if (url && currentSubjectId) {
                        const urlTitle = url.split('/').pop() || 'ูุงุฏุฉ';
                        saveMaterialToFirestore(urlTitle, url, 'link', 'mid', currentSubjectId);
                        document.getElementById('urlInput').value = '';
                    } else {
                        alert('ูุฑุฌู ุฅุฏุฎุงู ุฑุงุจุท ุตุงูุญ ูุงุฎุชูุงุฑ ูุงุฏุฉ.');
                    }
                });

                function saveMaterialToFirestore(title, url, type, exam, subjectId) {
                    db.collection('materials').add({
                        title: title,
                        url: url,
                        type: type.split('/')[0],
                        exam: exam,
                        subjectId: subjectId,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        alert('ุชู ุฅุถุงูุฉ ุงูููู ุจูุฌุงุญ!');
                        loadMaterials(currentSubjectId);
                    }).catch(error => {
                        console.error("Error adding material: ", error);
                    });
                }
                
                // Function to load announcements from Firestore
                function loadAnnouncements() {
                    const sidebarAnnouncements = document.getElementById('sidebarAnnouncements');
                    sidebarAnnouncements.innerHTML = '';
                    db.collection('posts').where('type', '==', 'announcement').orderBy('timestamp', 'desc').limit(5).get()
                        .then(snapshot => {
                            if (snapshot.empty) {
                                sidebarAnnouncements.innerHTML = `<p class="text-sm text-purple-700 leading-relaxed">ูุง ุชูุฌุฏ ุฅุนูุงูุงุช ุญุงููุงู.</p>`;
                            } else {
                                snapshot.forEach(doc => {
                                    const announcement = doc.data();
                                    const announcementItem = document.createElement('p');
                                    announcementItem.className = 'text-sm text-purple-700 leading-relaxed';
                                    announcementItem.textContent = announcement.content;
                                    sidebarAnnouncements.appendChild(announcementItem);
                                });
                            }
                        })
                        .catch(error => {
                            console.error("Error loading announcements: ", error);
                        });
                }
                
                // Posts functions
                let currentPostType = 'normal';
                function showCreatePost() {
                    document.getElementById('createPostSection').classList.remove('hidden');
                }
                function cancelCreatePost() {
                    document.getElementById('createPostSection').classList.add('hidden');
                    document.getElementById('createPostForm').reset();
                    document.getElementById('pollOptions').classList.add('hidden');
                    selectPostType('normal');
                }
                function selectPostType(type) {
                    currentPostType = type;
                    document.querySelectorAll('.post-type-btn').forEach(btn => {
                        btn.classList.remove('bg-purple-600', 'text-white');
                        btn.classList.add('bg-gray-200', 'text-gray-700');
                    });
                    document.querySelector(`.post-type-btn[data-type="${type}"]`).classList.remove('bg-gray-200', 'text-gray-700');
                    document.querySelector(`.post-type-btn[data-type="${type}"]`).classList.add('bg-purple-600', 'text-white');
                    document.getElementById('pollOptions').classList.toggle('hidden', type !== 'poll');
                }
                function addPollChoice() {
                    const pollChoices = document.getElementById('pollChoices');
                    const newChoice = document.createElement('input');
                    newChoice.type = 'text';
                    newChoice.className = 'poll-choice w-full px-3 py-2 border border-gray-300 rounded-lg';
                    newChoice.placeholder = `ุงูุฎูุงุฑ ${pollChoices.children.length + 1}`;
                    pollChoices.appendChild(newChoice);
                }
                document.getElementById('createPostForm').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const content = document.getElementById('postContent').value;
                    const targetYear = document.getElementById('targetYear').value;
                    const priority = document.getElementById('postPriority').value;
                    const images = document.getElementById('postImages').files;
                    let imageUrls = [];
                    
                    if (images.length > 0) {
                        for (const image of images) {
                            const storageRef = storage.ref(`posts/${Date.now()}_${image.name}`);
                            const uploadTask = await storageRef.put(image);
                            const url = await uploadTask.ref.getDownloadURL();
                            imageUrls.push(url);
                        }
                    }

                    const postData = {
                        author: currentUser.uid,
                        authorName: document.getElementById('userFullName').textContent,
                        content: content,
                        targetYear: targetYear,
                        priority: priority,
                        type: currentPostType,
                        images: imageUrls,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    if (currentPostType === 'poll') {
                        const pollChoices = Array.from(document.querySelectorAll('.poll-choice')).map(input => input.value).filter(val => val);
                        postData.poll = {
                            choices: pollChoices.map(choice => ({ text: choice, votes: 0 })),
                            voters: []
                        };
                    }

                    db.collection('posts').add(postData)
                        .then(() => {
                            alert('ุชู ูุดุฑ ุงูููุดูุฑ ุจูุฌุงุญ!');
                            cancelCreatePost();
                            loadPosts();
                            if (currentPostType === 'announcement') {
                                loadAnnouncements();
                            }
                        })
                        .catch(error => {
                            console.error("Error adding post: ", error);
                            alert('ูุดู ูู ูุดุฑ ุงูููุดูุฑ.');
                        });
                });
                
                function loadPosts() {
                    const postsFeed = document.getElementById('postsFeed');
                    postsFeed.innerHTML = '';
                    const postsRef = db.collection('posts').orderBy('timestamp', 'desc');
                    postsRef.onSnapshot(snapshot => {
                        postsFeed.innerHTML = '';
                        if (snapshot.empty) {
                            document.getElementById('postsEmptyState').classList.remove('hidden');
                        } else {
                            document.getElementById('postsEmptyState').classList.add('hidden');
                            snapshot.forEach(doc => {
                                const post = doc.data();
                                const postElement = document.createElement('div');
                                postElement.className = 'bg-white rounded-lg shadow-md p-6 border border-gray-100 fade-in';
                                postElement.innerHTML = `
                                    <div class="flex items-start space-x-4 space-x-reverse mb-4">
                                        <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white text-sm font-semibold">
                                            ${post.authorName[0]}
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-gray-900">${post.authorName}</h4>
                                            <p class="text-xs text-gray-500">${post.timestamp ? new Date(post.timestamp.seconds * 1000).toLocaleString('ar-SA') : 'ุงูุขู'}</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-800 mb-4">${post.content}</p>
                                    ${post.images && post.images.length > 0 ? `<div class="mt-4"><img src="${post.images[0]}" class="rounded-lg max-h-64 w-full object-cover"></div>` : ''}
                                `;
                                postsFeed.appendChild(postElement);
                            });
                        }
                    });
                }
                
                // Exams functions
                document.getElementById('addExamForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const subject = document.getElementById('newExamSubject').value;
                    const year = document.getElementById('newExamYear').value;
                    const date = document.getElementById('newExamDate').value;
                    const time = document.getElementById('newExamTime').value;
                    
                    db.collection('exams').add({
                        subject: subject,
                        year: parseInt(year),
                        date: new Date(`${date}T${time}`),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        closeAddExamModal();
                        alert('ุชู ุฅุถุงูุฉ ุงูุงูุชุญุงู ุจูุฌุงุญ!');
                        loadExams();
                    }).catch(error => {
                        console.error("Error adding exam: ", error);
                    });
                });
                
                function loadExams() {
                    const examsCalendar = document.getElementById('examsCalendar');
                    examsCalendar.innerHTML = '';
                    const examsRef = db.collection('exams').orderBy('date', 'asc');
                    examsRef.onSnapshot(snapshot => {
                        examsCalendar.innerHTML = '';
                        if (snapshot.empty) {
                            document.getElementById('examsEmptyState').classList.remove('hidden');
                        } else {
                            document.getElementById('examsEmptyState').classList.add('hidden');
                            snapshot.forEach(doc => {
                                const exam = doc.data();
                                const examDate = exam.date.toDate();
                                const examItem = document.createElement('div');
                                examItem.className = 'bg-white rounded-lg shadow-md p-6 border border-gray-100 card-hover';
                                examItem.innerHTML = `
                                    <div class="flex items-center space-x-3 space-x-reverse mb-3">
                                        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-xl">๐</div>
                                        <div>
                                            <h3 class="font-semibold text-gray-900">${exam.subject}</h3>
                                            <p class="text-sm text-gray-600">ุงูุณูุฉ ${exam.year}</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-700 font-medium">ุงูุชุงุฑูุฎ: ${examDate.toLocaleDateString('ar-SA')}</p>
                                    <p class="text-gray-700 font-medium">ุงูููุช: ${examDate.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })}</p>
                                `;
                                examsCalendar.appendChild(examItem);
                            });
                        }
                    });
                }
                
                function filterExams() {
                    const yearFilter = document.getElementById('examYearFilter').value;
                    const examsRef = yearFilter === 'all' ? db.collection('exams').orderBy('date', 'asc') : db.collection('exams').where('year', '==', parseInt(yearFilter)).orderBy('date', 'asc');
                    
                    examsRef.onSnapshot(snapshot => {
                        const examsCalendar = document.getElementById('examsCalendar');
                        examsCalendar.innerHTML = '';
                        if (snapshot.empty) {
                            document.getElementById('examsEmptyState').classList.remove('hidden');
                        } else {
                            document.getElementById('examsEmptyState').classList.add('hidden');
                            snapshot.forEach(doc => {
                                const exam = doc.data();
                                const examDate = exam.date.toDate();
                                const examItem = document.createElement('div');
                                examItem.className = 'bg-white rounded-lg shadow-md p-6 border border-gray-100 card-hover';
                                examItem.innerHTML = `
                                    <div class="flex items-center space-x-3 space-x-reverse mb-3">
                                        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-xl">๐</div>
                                        <div>
                                            <h3 class="font-semibold text-gray-900">${exam.subject}</h3>
                                            <p class="text-sm text-gray-600">ุงูุณูุฉ ${exam.year}</p>
                                        </div>
                                    </div>
                                    <p class="text-gray-700 font-medium">ุงูุชุงุฑูุฎ: ${examDate.toLocaleDateString('ar-SA')}</p>
                                    <p class="text-gray-700 font-medium">ุงูููุช: ${examDate.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })}</p>
                                `;
                                examsCalendar.appendChild(examItem);
                            });
                        }
                    });
                }
                
                // Chat functions
                function sendMessage() {
                    const chatInput = document.getElementById('chatInput');
                    const message = chatInput.value.trim();
                    if (message && currentUser) {
                        db.collection('chat').add({
                            senderId: currentUser.uid,
                            senderName: document.getElementById('userFullName').textContent,
                            message: message,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        }).then(() => {
                            chatInput.value = '';
                        }).catch(error => {
                            console.error("Error sending message: ", error);
                        });
                    }
                }
                
                function loadChatMessages() {
                    const chatMessages = document.getElementById('chatMessages');
                    db.collection('chat').orderBy('timestamp', 'asc').limit(50).onSnapshot(snapshot => {
                        chatMessages.innerHTML = '';
                        snapshot.forEach(doc => {
                            const message = doc.data();
                            const isCurrentUser = message.senderId === currentUser.uid;
                            const messageElement = document.createElement('div');
                            messageElement.className = `flex items-start space-x-3 space-x-reverse ${isCurrentUser ? 'justify-end' : ''}`;
                            messageElement.innerHTML = `
                                <div class="w-8 h-8 ${isCurrentUser ? 'hidden' : 'bg-purple-600'} rounded-full flex items-center justify-center text-white text-sm font-semibold">
                                    ${isCurrentUser ? '' : message.senderName[0]}
                                </div>
                                <div class="${isCurrentUser ? 'bg-purple-600 text-white' : 'bg-purple-100'} rounded-lg p-3 max-w-xs">
                                    <div class="text-sm font-medium ${isCurrentUser ? '' : 'text-purple-900'}">${message.senderName}</div>
                                    <div class="text-sm">${message.message}</div>
                                    <div class="text-xs ${isCurrentUser ? 'text-gray-200' : 'text-purple-500'} mt-1">${message.timestamp ? new Date(message.timestamp.seconds * 1000).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }) : 'ุงูุขู'}</div>
                                </div>
                            `;
                            chatMessages.appendChild(messageElement);
                        });
                        chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to the bottom
                    });
                }

                function initEventlisteners() {
                    // Home Page Buttons
                    document.getElementById('loginBtn').addEventListener('click', showLoginModal);
                    document.getElementById('registerBtn').addEventListener('click', showRegisterModal);
                    document.getElementById('heroLoginBtn').addEventListener('click', showLoginModal);
                    
                    // User Menu Button
                    document.getElementById('userMenuBtn').addEventListener('click', function() {
                        const dropdown = document.getElementById('userDropdown');
                        dropdown.classList.toggle('hidden');
                    });
                    
                    // Hide dropdown when clicking outside
                    window.addEventListener('click', function(e) {
                        if (!document.getElementById('userMenuBtn').contains(e.target) && !document.getElementById('userDropdown').contains(e.target)) {
                            document.getElementById('userDropdown').classList.add('hidden');
                        }
                    });
                    
                    // Back to Subjects button
                    document.getElementById('backToSubjects').addEventListener('click', () => {
                        document.getElementById('subjectMaterials').classList.add('hidden');
                        document.getElementById('semesterContent').classList.remove('hidden');
                    });
                }

                // Initialize the application
                document.addEventListener('DOMContentLoaded', function() {
                    initEventlisteners();
                });
            </script>
</body>
</html>
